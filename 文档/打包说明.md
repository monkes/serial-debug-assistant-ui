# 打包说明文档

## 准备工作

在开始打包之前，请确保已完成以下准备工作：

1. 安装必要的图标文件到 `debug_assistant/resources/` 目录
2. 确保所有依赖项在 `debug_assistant/requirements.txt` 中正确列出
3. 检查 `debian/control` 文件中的依赖项是否正确
4. 确保系统插件目录 `plugins/` 存在（可为空）
5. 用户插件目录将在首次运行时自动创建

## 构建deb包

### 方法1: 使用构建脚本（推荐）

```bash
# 使用构建脚本
./build.sh
```

构建脚本会自动完成以下步骤：
1. 构建Debian包
2. 清理临时文件和编译过的文件
3. 清理父目录中的构建产物

### 方法2: 使用dpkg-deb（简单方法）

```bash
# 创建构建目录
mkdir -p build/debug-assistant_1.0.0

# 创建目录结构
cd build/debug-assistant_1.0.0
mkdir -p DEBIAN
mkdir -p usr/lib/debug-assistant
mkdir -p usr/share/applications
mkdir -p usr/share/icons/hicolor/256x256/apps
mkdir -p usr/share/icons/hicolor/128x128/apps
mkdir -p usr/share/icons/hicolor/64x64/apps
mkdir -p usr/share/icons/hicolor/48x48/apps
mkdir -p usr/share/doc/debug-assistant

# 复制文件
cp -r ../../debug_assistant/* usr/lib/debug-assistant/
cp ../../share/applications/debug-assistant.desktop usr/share/applications/
cp ../../debug_assistant/resources/icon256x256.png usr/share/icons/hicolor/256x256/apps/debug-assistant.png
cp ../../debug_assistant/resources/icon128x128.png usr/share/icons/hicolor/128x128/apps/debug-assistant.png
cp ../../debug_assistant/resources/icon64x64.png usr/share/icons/hicolor/64x64/apps/debug-assistant.png
cp ../../debug_assistant/resources/icon48x48.png usr/share/icons/hicolor/48x48/apps/debug-assistant.png
cp ../../README.md usr/share/doc/debug-assistant/
cp ../../LICENSE usr/share/doc/debug-assistant/

# 创建控制文件
cat > DEBIAN/control << EOF
Package: debug-assistant
Version: 1.0.0
Section: python
Priority: optional
Architecture: all
Depends: python3 (>= 3.6), python3-pyqt5, python3-serial
Maintainer: Debug Assistant Team <support@debugassistant.com>
Description: A debug tool with plugin support
 Debug Assistant is a powerful debugging tool that supports dynamic
  loading of Python plugins.
EOF

# 创建启动脚本
cat > usr/bin/debug-assistant << EOF
#!/bin/bash
cd /usr/lib/debug-assistant
python3 main.py "$@"
EOF
chmod +x usr/bin/debug-assistant

# 计算安装大小
du -sk usr | awk '{print $1 * 1024}' > DEBIAN/installed-size

# 构建deb包
cd ..
dpkg-deb --build debug-assistant_1.0.0
```

### 方法3: 使用debuild（标准方法）

```bash
# 安装构建工具
sudo apt-get install debhelper dh-python python3-setuptools

# 确保debian/rules可执行
chmod +x debian/rules

# 构建包
debuild -us -uc
```

## 安装和测试

```bash
# 安装deb包
sudo dpkg -i debug-assistant_1.0.0_all.deb

# 如果有依赖问题
sudo apt-get install -f

# 测试运行
debug-assistant
```

## 卸载

```bash
# 卸载包
sudo apt-get remove debug-assistant

# 完全卸载（包括配置文件）
sudo apt-get purge debug-assistant

# 清理不需要的依赖
sudo apt-get autoremove
```

## 注意事项

1. 确保所有脚本文件有正确的执行权限
2. 图标文件应该使用PNG格式
3. desktop文件应该符合freedesktop.org标准
4. 在打包前测试应用程序是否正常运行
5. 检查包的依赖项是否完整
6. 系统插件目录需要root权限才能修改
7. 用户插件目录会自动创建，无需root权限
8. 详见插件权限说明.md了解插件权限管理机制
